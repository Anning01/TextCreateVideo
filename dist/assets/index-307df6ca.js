import{l as z,a as g}from"./url-25a5bb11.js";/* empty css                        *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                   */import"./el-tooltip-4ed993c7.js";import{u as R}from"./index-971e13c8.js";import{d as j,C as r,D as G,o as d,b as H,f as l,w as a,g as n,c as f,a as x,e as v,t as J,F as K,G as c,H as k,I as L,J as q,K as A,L as O,M as Q,N as W}from"./index-b6941629.js";const X=v("div",{class:"el-upload__tip"}," 只允许上传txt文件 ",-1),Y={class:"dialog-footer"},Z=v("br",null,null,-1),de=j({__name:"index",setup(ee){const V=r(1),w=r(),p=r(1),m=r(10),y=r(null),i=r(!1),C=r(""),E=e=>{w.value=e},D=e=>{m.value=e},B=e=>{p.value=e},N=e=>{y.value=e,i.value=!i.value,C.value=e.fail_info},S=()=>{let e=new FormData;e.append("file",w.value.raw),z(g.book_list,"post",e).then(t=>{c({title:"上传成功",message:t.data.message,type:"success"}),window.location.reload()}).catch(t=>{c({title:"上传失败",message:t.data.message,type:"error"})})},h=e=>{z(g.create_video+e.id,"get").then(t=>{t.data.code===200?c({title:"创建成功",message:k("i",{style:"color: teal"},t.data.message)}):c({title:"创建失败",message:k("i",{style:"color: red"},t.data.message)}),_.get_book_list()}).catch(t=>{c({title:"创建失败",message:k("i",{style:"color: red"},t.message)})})},$=()=>{i.value=!i.value,h(y.value),y.value=null},F=e=>{window.open(g.base+e.video_path)},T=e=>{window.open(g.base+e.path)},{home:_}=R();return G(()=>{_.get_book_list()}),(e,t)=>{const s=L,U=q,u=A,P=O,I=Q,M=W;return d(),H(K,null,[l(U,{ref:"uploadRef",limit:V.value,"on-change":E,"auto-upload":!1,accept:".txt"},{trigger:a(()=>[l(s,{type:"primary"},{default:a(()=>[n("选择文件")]),_:1})]),tip:a(()=>[X]),default:a(()=>[l(s,{class:"ml-3",type:"success",onClick:S},{default:a(()=>[n(" 上传到服务器 ")]),_:1})]),_:1},8,["limit"]),l(P,{data:x(_).book_list.slice((p.value-1)*m.value,p.value*m.value),border:"",style:{width:"100%"}},{default:a(()=>[l(u,{prop:"id",label:"编号"}),l(u,{prop:"name",label:"书名"}),l(u,{prop:"create_dt",label:"创建时间"}),l(u,{label:"操作"},{default:a(o=>[l(s,{size:"small",type:"primary",onClick:b=>T(o.row)},{default:a(()=>[n("下载")]),_:2},1032,["onClick"])]),_:1}),l(u,{label:"视频"},{default:a(o=>[o.row.status=="default"?(d(),f(s,{key:0,size:"small",type:"success",onClick:b=>h(o.row)},{default:a(()=>[n("生成视频")]),_:2},1032,["onClick"])):o.row.status=="underway"?(d(),f(s,{key:1,size:"small",type:"warning",disabled:""},{default:a(()=>[n("进行中")]),_:1})):o.row.status=="failure"?(d(),f(s,{key:2,size:"small",type:"danger",onClick:b=>N(o.row)},{default:a(()=>[n("失败原因")]),_:2},1032,["onClick"])):(d(),f(s,{key:3,size:"small",type:"primary",onClick:b=>F(o.row)},{default:a(()=>[n("下载")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"]),l(I,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=o=>i.value=o),title:"失败原因",width:"30%",draggable:""},{footer:a(()=>[v("span",Y,[l(s,{onClick:t[0]||(t[0]=o=>i.value=!1)},{default:a(()=>[n("关闭")]),_:1}),l(s,{type:"primary",onClick:$},{default:a(()=>[n(" 重新生成 ")]),_:1})])]),default:a(()=>[v("span",null,J(C.value),1)]),_:1},8,["modelValue"]),Z,l(M,{"current-page":p.value,"page-size":m.value,layout:"total, sizes, prev, pager, next, jumper",total:x(_).book_list.length,onSizeChange:D,onCurrentChange:B},null,8,["current-page","page-size","total"])],64)}}});export{de as default};
