import"./axios-6304c0c0.js";/* empty css                        *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css                    */import"./el-tooltip-4ed993c7.js";import{u as K}from"./index-81bb5259.js";import{l as w,a as p}from"./url-566c741c.js";import{d as L,C as i,D as q,o as c,b as C,f as l,w as t,g as s,F as b,c as z,h as A,a as S,e as y,t as O,G as u,H as V,I as Q,J as W,K as X,L as Y,M as Z,N as ee}from"./index-b0380461.js";const te=y("div",{class:"el-upload__tip"}," 只允许上传txt文件 ",-1),ae={class:"dialog-footer"},le=y("br",null,null,-1),fe=L({__name:"index",setup(oe){const D=i(1),x=i(),m=i(1),_=i(10),k=i(null),r=i(!1),E=i(""),$=e=>{x.value=e},N=e=>{_.value=e},B=e=>{m.value=e},F=e=>{k.value=e,r.value=!r.value,E.value=e.fail_info},T=()=>{let e=new FormData;e.append("file",x.value.raw),w(p.book_list,"post",e).then(a=>{u({title:"上传成功",message:a.data.message,type:"success"}),window.location.reload()}).catch(a=>{u({title:"上传失败",message:a.data.message,type:"error"})})},h=e=>{w(p.create_video+e.id,"get").then(a=>{a.data.code===200?u({title:"创建成功",message:V("i",{style:"color: teal"},a.data.message)}):u({title:"创建失败",message:V("i",{style:"color: red"},a.data.message)}),g.get_book_list()}).catch(a=>{u({title:"创建失败",message:V("i",{style:"color: red"},a.message)})})},U=()=>{r.value=!r.value,h(k.value),k.value=null},P=e=>{window.open(p.base+e.video_path)},I=e=>{window.open(p.base+e.path)},{home:g}=K();q(()=>{g.get_book_list()});const f=i([]),M=e=>{f.value=e.map(a=>a.id)},R=()=>{if(f.value.length>0){const e=f.value.length;w(p.book_list,"delete",{id_list:f.value}).then(a=>{u({title:a.data.message,message:`成功删除了${e}条数据`,type:"success"}),window.location.reload()})}else u({title:"删除失败",message:"未选中任何数据",type:"error"})};return(e,a)=>{const n=Q,j=W,d=X,G=Y,H=Z,J=ee;return c(),C(b,null,[l(j,{ref:"uploadRef",limit:D.value,"on-change":$,"auto-upload":!1,accept:".txt"},{trigger:t(()=>[l(n,{type:"primary"},{default:t(()=>[s("选择文件")]),_:1})]),tip:t(()=>[te]),default:t(()=>[l(n,{class:"ml-3",type:"success",onClick:T},{default:t(()=>[s(" 上传到服务器 ")]),_:1})]),_:1},8,["limit"]),l(G,{onSelectionChange:M,data:S(g).book_list.slice((m.value-1)*_.value,m.value*_.value),border:"",style:{width:"100%"}},{default:t(()=>[l(d,{type:"selection",width:"55"}),l(d,{prop:"id",label:"编号"}),l(d,{prop:"name",label:"书名"}),l(d,{prop:"create_dt",label:"创建时间"}),l(d,{label:"操作"},{default:t(o=>[l(n,{size:"small",type:"primary",onClick:v=>I(o.row)},{default:t(()=>[s("下载")]),_:2},1032,["onClick"])]),_:1}),l(d,{label:"视频"},{default:t(o=>[o.row.status=="default"?(c(),C(b,{key:0},[o.row.status=="default"?(c(),z(n,{key:0,size:"small",type:"success",onClick:v=>h(o.row)},{default:t(()=>[s("生成视频")]),_:2},1032,["onClick"])):A("",!0)],64)):o.row.status=="underway"?(c(),z(n,{key:1,size:"small",type:"warning",disabled:""},{default:t(()=>[s("进行中")]),_:1})):o.row.status=="failure"?(c(),z(n,{key:2,size:"small",type:"danger",onClick:v=>F(o.row)},{default:t(()=>[s("失败原因")]),_:2},1032,["onClick"])):(c(),C(b,{key:3},[l(n,{size:"small",type:"primary",onClick:v=>P(o.row)},{default:t(()=>[s("下载")]),_:2},1032,["onClick"]),s("    "),l(n,{size:"small",type:"primary",onClick:v=>h(o.row)},{default:t(()=>[s("重新生成")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"]),l(n,{type:"primary",onClick:R},{default:t(()=>[s("删除")]),_:1}),l(H,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=o=>r.value=o),title:"失败原因",width:"30%",draggable:""},{footer:t(()=>[y("span",ae,[l(n,{onClick:a[0]||(a[0]=o=>r.value=!1)},{default:t(()=>[s("关闭")]),_:1}),l(n,{type:"primary",onClick:U},{default:t(()=>[s(" 重新生成 ")]),_:1})])]),default:t(()=>[y("span",null,O(E.value),1)]),_:1},8,["modelValue"]),le,l(J,{"current-page":m.value,"page-size":_.value,layout:"total, sizes, prev, pager, next, jumper",total:S(g).book_list.length,onSizeChange:N,onCurrentChange:B},null,8,["current-page","page-size","total"])],64)}}});export{fe as default};
