import{l as z,a as g}from "./url-494494b7.js";/* empty css                  */import{u as I}from "./index-dc37aae1.js";import{d as M,C as r,D as R,o as u,b as j,f as l,w as a,g as s,c as f,a as x,e as v,t as H,F as J,G as d,H as k,I as K,J as L,K as q,L as A,M as Q,N as W}from "./index-7d89fbe3.js";const X=v("div",{class:"el-upload__tip"}," 只允许上传txt文件 ",-1),Y={class:"dialog-footer"},Z=v("br",null,null,-1),ne=M({__name:"index",setup(ee){const V=r(1),w=r(),p=r(1),_=r(10),b=r(null),i=r(!1),C=r(""),E= e=>{w.value=e},D= e=>{_.value=e},S= e=>{p.value=e},T= e=>{b.value=e,i.value=!i.value,C.value=e.fail_info},B=()=>{let e=new FormData;e.append("file",w.value.raw),z(g.book_list,"post",e).then(t=>{d({title:"上传成功",message:t.data.message,type:"success"}),window.location.reload()}).catch(t=>{d({title:"上传失败",message:t.data.message,type:"error"})})},h= e=>{z(g.create_video+e.id,"get").then(t=>{t.data.code===200?d({title:"创建成功",message:k("i",{style:"color: teal"},t.data.message)}):d({title:"创建失败",message:k("i",{style:"color: red"},t.data.message)}),m.get_book_list()}).catch(t=>{d({title:"创建失败",message:k("i",{style:"color: red"},t.message)})})},N=()=>{i.value=!i.value,h(b.value),b.value=null},$= e=>{window.open(g.base+e.video_path)},F= e=>{window.open(g.base+e.path)},{home:m}=I();return R(()=>{m.get_book_list()}),(e, t)=>{const n=K,P=L,c=q,U=A,O=Q,G=W;return u(),j(J,null,[l(P,{ref:"uploadRef",limit:V.value,"on-change":E,"auto-upload":!1,accept:".txt"},{trigger:a(()=>[l(n,{type:"primary"},{default:a(()=>[s("选择文件")]),_:1})]),tip:a(()=>[X]),default:a(()=>[l(n,{class:"ml-3",type:"success",onClick:B},{default:a(()=>[s(" 上传到服务器 ")]),_:1})]),_:1},8,["limit"]),l(U,{data:x(m).book_list.slice((p.value-1)*_.value,p.value*_.value),border:"",style:{width:"100%"}},{default:a(()=>[l(c,{prop:"id",label:"编号"}),l(c,{prop:"name",label:"书名"}),l(c,{prop:"create_dt",label:"创建时间"}),l(c,{label:"操作"},{default:a(o=>[l(n,{size:"small",type:"primary",onClick: y=>F(o.row)},{default:a(()=>[s("下载")]),_:2},1032,["onClick"])]),_:1}),l(c,{label:"视频"},{default:a(o=>[o.row.status=="default"?(u(),f(n,{key:0,size:"small",type:"success",onClick: y=>h(o.row)},{default:a(()=>[s("生成视频")]),_:2},1032,["onClick"])):o.row.status=="underway"?(u(),f(n,{key:1,size:"small",type:"warning",disabled:""},{default:a(()=>[s("进行中")]),_:1})):o.row.status=="failure"?(u(),f(n,{key:2,size:"small",type:"danger",onClick: y=>T(o.row)},{default:a(()=>[s("失败原因")]),_:2},1032,["onClick"])):(u(),f(n,{key:3,size:"small",type:"primary",onClick: y=>$(o.row)},{default:a(()=>[s("下载")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"]),l(O,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]= o=>i.value=o),title:"失败原因",width:"30%",draggable:""},{footer:a(()=>[v("span",Y,[l(n,{onClick:t[0]||(t[0]= o=>i.value=!1)},{default:a(()=>[s("关闭")]),_:1}),l(n,{type:"primary",onClick:N},{default:a(()=>[s(" 重新生成 ")]),_:1})])]),default:a(()=>[v("span",null,H(C.value),1)]),_:1},8,["modelValue"]),Z,l(G,{"current-page":p.value,"page-size":_.value,layout:"total, sizes, prev, pager, next, jumper",total:x(m).book_list.length,onSizeChange:D,onCurrentChange:S},null,8,["current-page","page-size","total"])],64)}}});export{ne as default};
